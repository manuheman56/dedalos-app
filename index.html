<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>D√âDALO'S ‚Äì El Laberinto</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#1b1b1b">
  <style>
    :root { --gold: #d4af37; --blood: #8b0000; --parchment: #f2e6c9; --shadow: #0a0a0a; }
    body { margin: 0; font-family: 'Georgia', serif; background: var(--shadow); color: var(--parchment); display: flex; flex-direction: column; min-height: 100vh; }
    .screen { display: none; padding: 25px; animation: fadeIn 1.2s ease-in-out; flex-direction: column; align-items: center; }
    .active { display: flex; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    h1 { font-size: 3.5em; color: var(--gold); text-shadow: 0 0 20px rgba(212, 175, 55, 0.4); margin-bottom: 5px; text-align: center; letter-spacing: 4px; }
    .card { background: linear-gradient(145deg, #151515, #050505); border: 1px solid var(--gold); padding: 30px; border-radius: 4px; box-shadow: 0 10px 50px #000; width: 85%; max-width: 450px; text-align: center; border-image: radial-gradient(var(--gold), transparent) 1; }
    .action-dots { display: flex; justify-content: center; gap: 20px; margin: 25px 0; }
    .dot { width: 40px; height: 40px; border: 2px solid var(--gold); border-radius: 50%; box-shadow: 0 0 10px rgba(212, 175, 55, 0.2); transition: 0.5s; }
    .dot.used { background: var(--blood); border-color: var(--blood); box-shadow: 0 0 20px var(--blood); transform: scale(0.9); }
    .dot.used::after { content: '‚úï'; color: #000; font-size: 24px; line-height: 40px; font-weight: bold; }
    button { background: #4a0000; color: var(--gold); border: 1px solid var(--gold); padding: 18px; font-size: 1.1em; text-transform: uppercase; letter-spacing: 3px; cursor: pointer; margin: 12px 0; width: 100%; transition: 0.4s; }
    button:hover { background: var(--gold); color: #000; }
    .inventory { display: flex; justify-content: center; gap: 10px; margin-top: 20px; }
    .item { padding: 8px; border: 1px solid #333; font-size: 0.8em; opacity: 0.2; transition: 0.5s; }
    .item.active { opacity: 1; border-color: var(--gold); color: var(--gold); box-shadow: 0 0 10px var(--gold); }
    #game-log { font-style: italic; color: #888; margin-top: 20px; font-size: 1.1em; text-shadow: 1px 1px #000; }
  </style>
</head>
<body>

<audio id="snd-ambiente" loop src="ambiente.mp3"></audio>
<audio id="snd-accion" src="accion.mp3"></audio>
<audio id="snd-rugido" src="rugido.mp3"></audio>

<div id="intro" class="screen active">
  <h1>D√âDALO</h1>
  <div class="card">
    <p id="intro-text" style="line-height: 1.6;">Fuiste arrojado al coraz√≥n del laberinto de Creta. D√©dalo lo construy√≥... El Minotauro lo habita... Solo uno de vosotros... lograr√° escapar.</p>
    <button onclick="startNarrator()">Escuchar Voces</button>
  </div>
</div>

<div id="players" class="screen">
  <h2>¬øCu√°ntos Tributos?</h2>
  <div class="card">
    <button onclick="startGame(3)">III</button>
    <button onclick="startGame(4)">IV</button>
    <button onclick="startGame(5)">V</button>
    <button onclick="startGame(6)">VI</button>
  </div>
</div>

<div id="game" class="screen">
  <h2 id="turn-title" style="color: var(--gold); letter-spacing: 2px;">Tributo I</h2>
  <div class="card">
    <div class="action-dots">
      <div class="dot" id="d1"></div><div class="dot" id="d2"></div><div class="dot" id="d3"></div>
    </div>
    <button onclick="spendAction()">Ejecutar Acci√≥n</button>
    <div id="game-log">El laberinto aguarda...</div>
    <div class="inventory">
      <div id="inv-h" class="item" onclick="toggleItem('inv-h')">ü™ì Hacha</div>
      <div id="inv-l" class="item" onclick="toggleItem('inv-l')">üîë Llave</div>
      <div id="inv-e" class="item" onclick="toggleItem('inv-e')">üõ°Ô∏è Escudo</div>
    </div>
    <button class="secondary" onclick="finishTurn()" style="background:transparent; border-color:#444; color:#555; margin-top:25px; font-size: 0.8em;">Ceder Turno</button>
  </div>
</div>

<script>
let currentP = 1, totalP = 0, actions = 0;

function goTo(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function startNarrator() {
  const text = document.getElementById('intro-text').innerText;
  const msg = new SpeechSynthesisUtterance(text);
  
  // Buscar la voz m√°s grave disponible
  const voices = window.speechSynthesis.getVoices();
  const deepVoice = voices.find(v => v.lang.includes('es') && (v.name.includes('Google') || v.name.includes('Jorge'))) || voices[0];
  
  msg.voice = deepVoice;
  msg.lang = 'es-ES';
  msg.rate = 0.7; // Lento
  msg.pitch = 0.5; // Muy grave
  
  window.speechSynthesis.speak(msg);
  document.getElementById('snd-ambiente').play();
  document.getElementById('snd-ambiente').volume = 0.3;
  goTo('players');
}

function startGame(n) { totalP = n; goTo('game'); resetTurn(); }

function spendAction() {
  if (actions < 3) {
    actions++;
    document.getElementById('snd-accion').play();
    document.getElementById('d' + actions).classList.add('used');
    document.getElementById('game-log').innerText = "Acci√≥n grabada en piedra.";
  }
}

function toggleItem(id) { document.getElementById(id).classList.toggle('active'); }

function finishTurn() {
  window.speechSynthesis.cancel();
  document.getElementById('snd-rugido').play();
  document.getElementById('game-log').innerHTML = "<span style='color:var(--blood)'>EL MINOTAURO SE MUEVE II CASILLAS...</span>";
  
  setTimeout(() => {
    currentP = (currentP % totalP) + 1;
    resetTurn();
  }, 3500);
}

function resetTurn() {
  actions = 0;
  document.getElementById('turn-title').innerText = "Tributo " + (currentP === 1 ? "I" : currentP === 2 ? "II" : currentP === 3 ? "III" : currentP === 4 ? "IV" : currentP === 5 ? "V" : "VI");
  document.querySelectorAll('.dot').forEach(d => d.classList.remove('used'));
}

// Cargar voces al inicio para evitar errores
window.speechSynthesis.onvoiceschanged = () => window.speechSynthesis.getVoices();

if ('serviceWorker' in navigator) { navigator.serviceWorker.register('sw.js'); }
</script>
</body>
</html>