<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>DÉDALO'S – Guía del Tributo</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#1b1b1b">
  <style>
    :root { --gold: #d4af37; --blood: #8b0000; --parchment: #f2e6c9; --shadow: #0a0a0a; }
    body { margin: 0; font-family: 'Georgia', serif; background: var(--shadow); color: var(--parchment); display: flex; flex-direction: column; min-height: 100vh; }
    .screen { display: none; padding: 25px; animation: fadeIn 1.2s ease-in-out; flex-direction: column; align-items: center; }
    .active { display: flex; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    h1 { font-size: 2.8em; color: var(--gold); text-shadow: 0 0 15px rgba(212, 175, 55, 0.4); text-align: center; letter-spacing: 4px; margin-bottom: 10px; }
    h3 { color: var(--gold); border-bottom: 1px solid var(--blood); padding-bottom: 5px; width: 100%; }
    .card { background: linear-gradient(145deg, #151515, #050505); border: 1px solid var(--gold); padding: 25px; border-radius: 4px; box-shadow: 0 10px 50px #000; width: 90%; max-width: 500px; }
    
    /* Instrucciones para novatos */
    .instruction-step { text-align: left; font-size: 0.95em; margin-bottom: 15px; line-height: 1.4; }
    .instruction-step b { color: var(--gold); }

    .action-dots { display: flex; justify-content: center; gap: 20px; margin: 20px 0; }
    .dot { width: 35px; height: 35px; border: 2px solid var(--gold); border-radius: 50%; transition: 0.5s; }
    .dot.used { background: var(--blood); box-shadow: 0 0 15px var(--blood); }
    
    button { background: #4a0000; color: var(--gold); border: 1px solid var(--gold); padding: 15px; font-size: 1em; text-transform: uppercase; letter-spacing: 2px; cursor: pointer; margin: 10px 0; width: 100%; }
    button:hover { background: var(--gold); color: #000; }
    .secondary { background: transparent; border-color: #444; color: #777; font-size: 0.8em; }
  </style>
</head>
<body>

<audio id="snd-ambiente" loop src="ambiente.mp3"></audio>
<audio id="snd-rugido" src="rugido.mp3"></audio>

<div id="intro" class="screen active">
  <h1>DÉDALO</h1>
  <div class="card">
    <h3>El Mito</h3>
    <p id="lore-text">Sois los tributos arrojados al laberinto de Creta. El arquitecto Dédalo lo diseñó para que nadie saliera jamás.</p>
    <h3>Tu Objetivo</h3>
    <p><b>Sé el primero en escapar.</b> Debes abrirte camino desde la entrada hasta una de las salidas mientras bloqueas a tus rivales y evitas al Minotauro.</p>
    <button onclick="startNarrator()">Entender las Reglas</button>
  </div>
</div>

<div id="how-to" class="screen">
  <h1>INSTRUCCIONES</h1>
  <div class="card">
    <div class="instruction-step">
      <b>1. Tu Mano:</b> Siempre tienes 3 losetas.
    </div>
    <div class="instruction-step">
      <b>2. Acciones (3 por turno):</b> Puedes poner una loseta en el tablero, mover tu ficha o rotar una loseta donde ya estés.
    </div>
    <div class="instruction-step">
      <b>3. El Minotauro:</b> Aparece con losetas especiales. Al final de cada turno, ¡se mueve hacia el jugador más cercano!
    </div>
    <button onclick="goTo('players')">Empezar a Jugar</button>
  </div>
</div>

<div id="players" class="screen">
  <h2>¿Cuántos Tributos arriesgan su vida?</h2>
  <div class="card">
    <button onclick="startGame(3)">III Jugadores</button>
    <button onclick="startGame(4)">IV Jugadores</button>
    <button onclick="startGame(5)">V Jugadores</button>
    <button onclick="startGame(6)">VI Jugadores</button>
  </div>
</div>

<div id="game" class="screen">
  <h2 id="turn-title" style="color: var(--gold);">TRIBUTO I</h2>
  <div class="card">
    <p style="font-size: 0.8em; opacity: 0.7;">Recuerda: Tienes 3 acciones (Poner loseta, Mover o Rotar).</p>
    <div class="action-dots">
      <div class="dot" id="d1"></div><div class="dot" id="d2"></div><div class="dot" id="d3"></div>
    </div>
    <button onclick="spendAction()">Gastar Acción</button>
    <div id="game-log" style="font-style: italic; margin: 10px 0;">El laberinto aguarda...</div>
    <button class="secondary" onclick="finishTurn()">Terminar Turno y Mover Minotauro</button>
  </div>
</div>

<script>
let currentP = 1, totalP = 0, actions = 0;

function goTo(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function startNarrator() {
  const text = "Escuchad, tributos. Vuestro objetivo es simple: escapar antes que los demás. En cada turno tenéis tres acciones. Podéis colocar pasillos, moveros por ellos o rotar el laberinto. Pero cuidado, tras vuestro movimiento, el Minotauro despertará.";
  const msg = new SpeechSynthesisUtterance(text);
  
  // LÓGICA DE VOZ MEJORADA
  const voices = window.speechSynthesis.getVoices();
  // Buscamos voces masculinas o con nombres que suelen ser graves
  const voice = voices.find(v => v.lang.includes('es') && (v.name.includes('Male') || v.name.includes('Google español') || v.name.includes('Jorge'))) || voices[0];
  
  msg.voice = voice;
  msg.rate = 0.75; // Muy pausado
  msg.pitch = 0.4; // Forzamos el tono más grave posible (el mínimo es 0)
  
  window.speechSynthesis.speak(msg);
  document.getElementById('snd-ambiente').play();
  document.getElementById('snd-ambiente').volume = 0.2;
  goTo('how-to');
}

function startGame(n) { totalP = n; goTo('game'); resetTurn(); }

function spendAction() {
  if (actions < 3) {
    actions++;
    document.getElementById('d' + actions).classList.add('used');
    document.getElementById('game-log').innerText = "Acción " + actions + " completada.";
  }
}

function finishTurn() {
  window.speechSynthesis.cancel();
  document.getElementById('snd-rugido').play();
  document.getElementById('game-log').innerHTML = "<span style='color:var(--blood)'>¡EL MINOTAURO AVANZA 2 CASILLAS!</span>";
  
  setTimeout(() => {
    currentP = (currentP % totalP) + 1;
    resetTurn();
  }, 3500);
}

function resetTurn() {
  actions = 0;
  document.getElementById('turn-title').innerText = "TRIBUTO " + currentP;
  document.querySelectorAll('.dot').forEach(d => d.classList.remove('used'));
  document.getElementById('game-log').innerText = "Es tu turno. Planea tus 3 acciones.";
}

// Cargar voces para que estén listas al pulsar
window.speechSynthesis.onvoiceschanged = () => window.speechSynthesis.getVoices();

if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js');
}
</script>
</body>
</html>